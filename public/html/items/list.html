<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RememberIt</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css"
          integrity="sha384-3AB7yXWz4OeoZcPbieVW64vVXEwADiYyAEhwilzWsLw+9FgqpyjjStpPnpBO8o8S" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/public/vendors/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/public/css/grid.css">
    <link rel="stylesheet" type="text/css" href="/public/css/card.css">
    <link rel="stylesheet" type="text/css" href="/public/css/list.css">
    <script type="application/javascript" src="https://code.jquery.com/jquery-2.2.3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.3/handlebars.min.js"></script>
    <script type="application/javascript" src="/public/script/list.js"></script>
    <script>
        function elapsedHours(startTime) {
            // record start time
            // var startTime = new Date();
            // later record end time
            var endTime = new Date();
            // console.dir('Now ' + endTime);

            // time difference in ms
            var timeDiff = endTime - startTime;

            // strip the ms
            timeDiff /= 1000;
            timeDiff = Math.floor(timeDiff);
            var elapsedHours = timeDiff / 60 / 60;
            elapsedHours = Math.floor(elapsedHours);
            // console.dir('timeDiff ' + elapsedHours);

            // get seconds (Original had 'round' which incorrectly counts 0:28, 0:29, 1:30 ... 1:59, 1:0)
            var seconds = Math.round(timeDiff % 60);

            // remove seconds from the date
            timeDiff = Math.floor(timeDiff / 60);

            // get minutes
            var minutes = Math.round(timeDiff % 60);

            // remove minutes from the date
            timeDiff = Math.floor(timeDiff / 60);

            // get hours
            var hours = Math.round(timeDiff % 24);

            // remove hours from the date
            timeDiff = Math.floor(timeDiff / 24);

            // the rest of timeDiff is number of days
            var days = timeDiff ;
            return elapsedHours;
        }

        function remainedHours(startTime) {
            // record start time
            // var startTime = new Date();
            // later record end time
            var endTime = new Date();
            // console.dir('Now ' + endTime);

            // time difference in ms
            var timeDiff = endTime - startTime;

            // strip the ms
            timeDiff /= 1000;
            timeDiff = Math.floor(timeDiff);


            var timeRemain = 6 * 60 * 60 - timeDiff;


            var remainedHours = timeRemain / 60 / 60;
            remainedHours = Math.round(remainedHours);
            // console.dir('timeDiff ' + elapsedHours);


            return remainedHours;
        }

        Handlebars.registerHelper("getDate", function (remembered) {
            var d = new Date(remembered);
            // console.dir(remembered);
            // console.dir(d);
            // var datestring = d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes();
            // return datestring;
            var remained = remainedHours(d);
            var comment = 'You can change state after ' + remained + ' hours';
            if (remained <= 0) {
                comment = 'You can change state';
            }
            return comment;
        });
        Handlebars.registerHelper("getStateTitle", function (id) {
            if (itemState == 1) {
                return "memorized";
            } else {
                return "forgot";
            }
        });

        Handlebars.registerHelper("getDescContent", function (content) {
            var newContent = content.replace("\r\n", "</br>");
            newContent = newContent.replace("\n\r", "</br>");
            newContent = newContent.replace("\r", "</br>");
            newContent = newContent.replace("\n", "</br>");
            return newContent;
        });
    </script>
    <script id="card-template" type="text/template">
        <div class="card-container col-3 col-t-4 col-s-6">
            <button class="card-close-btn" id="{{id}}">X</button>
            <div class="card">
                <div class="card-title">
                    <div class="card-title-content">{{item}}</div>
                    <div class="card-title-edit" id={{id}}><i class="far fa-edit"></i></div>
                </div>
                <div class="card-desc">
                    <div class="card-desc-content">{{item_desc}}</div>
                    <div class="card-desc-block">
                        <p>Tap to see answer.</p>
                    </div>
                </div>
                <div class="card-bottom-content">
                    <div class="card-created">
                        {{getDate remembered}}
                    </div>
                    <div class="card-state-div">
                        <div class="card-state-inner-div">
                            <div class="card-state">
                                state : {{remember_state}}
                            </div>
                            <div class="card-forget-check-div">
                                <div class="card-forget-check-text">forget</div>
                                <input id={{id}} class="card-forget-check-box" type="checkbox">
                            </div>
                            <div class="card-remember-check-div">
                                <div class="card-remember-check-text">remembered</div>
                                <input id={{id}} class="card-remember-check-box" type="checkbox">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-link">
                <a href="http://endic.naver.com/search.nhn?searchOption=all&query={{item}}" style="float:left;">Naver</a>
                <a href="https://translate.google.co.kr/#en/ko/{{item}}" style="float:right;">Google</a>
            </div>
        </div>
    </script>


    <script>
        $("document").ready(function () {
            $(".dropbtn").click(function(evt){
                $('.dropdown-content').toggle('show');

            });
            $('.dropdown-menu1').on("click",function(){
                // var usersid =  $(this).attr("id");
                $('.dropdown-content').toggle('show');
                //post code
                updateContent(1);
            });
            $('.dropdown-menu2').on("click",function(){
                // var usersid =  $(this).attr("id");
                $('.dropdown-content').toggle('show');
                //post code
                updateContent(2);
            });
            $('.dropdown-menu3').on("click",function(){
                // var usersid =  $(this).attr("id");
                $('.dropdown-content').toggle('show');
                //post code
                updateContent(3);
            });
            $('.dropdown-menu4').on("click",function(){
                // var usersid =  $(this).attr("id");
                $('.dropdown-content').toggle('show');
                //post code
                updateContent(4);
            });
            $('.dropdown-menu5').on("click",function(){
                // var usersid =  $(this).attr("id");
                $('.dropdown-content').toggle('show');
                //post code
                updateContent(5);
            });
            $('#top-div').click(function (evt) {
                console.log("top");
                $(window).scrollTop(0);
            });
            setTitle();
            requestItems();
        });
    </script>

    <script>
        $(window).scroll(function () {
            if ($(window).scrollTop() > $(document).height() - $(window).height() - 50) {
                requestItems();
            }
        });
    </script>
    <script>
    </script>
</head>
<body>
<div id="wrapper">
    <div class="nav">
        <ul class="nav-ul">
            <li><a href="/">&Xi; HOME</a></li>
            <li>
                <div class="dropdown">
                    <button class="dropbtn">Stage
                        <i class="fa fa-caret-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="#" class="dropdown-menu1">New</a>
                        <a href="#" class="dropdown-menu2">1'st Turn</a>
                        <a href="#" class="dropdown-menu3">2'nd Turn</a>
                        <a href="#" class="dropdown-menu4">3'rd Turn</a>
                        <a href="#" class="dropdown-menu5">Long-Term Memory</a>
                    </div>
                </div>
            </li>
            <li style="float: right;"><a href="/LogOut">Logout</a></li>
            <li style="float: right;"><a href="/items/new">New</a></li>
        </ul>
    </div>

    <div id="main-content" style="overflow: hidden;">
        <h1 id="main-title" style="text-align: center">
            <!--<script>getTitle()</script>-->
        </h1>
        <!--<button id="update-content-button" onclick="updateContent()">-->
            <!--<script>getUpdateTitle()</script>-->
        <!--</button>-->

        <div id="content" style="display: block;float: left;width: 100%">
        </div>
    </div>
    <div id="top-div">
        TOP
    </div>
</div>
</body>
</html>